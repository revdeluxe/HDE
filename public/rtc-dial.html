<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SIP.js 0.20+ WebRTC Client</title>
</head>
<body>
  <h2>Status: <span id="status">Loading…</span></h2>
  <script src="/js/sip.min.js"></script>
  <script>
    async function startSIP() {
      const userAgent = new SIP.UserAgent({
        uri: SIP.UserAgent.makeURI("sip:webrtc_user@192.168.18.17"),
        transportOptions: {
          server: "wss://192.168.18.17:8089/ws"
        },
        authorizationUsername: "webrtc_user",
        authorizationPassword: "hdecall",
        sessionDescriptionHandlerFactoryOptions: {
          constraints: { audio: true, video: false }
        },
        delegate: {
          onInvite(invitation) {
            document.getElementById("status").innerText = "Incoming call ??";
            console.log("Incoming call", invitation);
          }
        }
      });

      const registerer = new SIP.Registerer(userAgent);

      try {
        await userAgent.start();
        await registerer.register();
        document.getElementById("status").innerText = "Registered ?";
      } catch (err) {
        console.error("Registration error:", err);
        document.getElementById("status").innerText = "Registration Failed ?";
      }
    }
    startSIP();
  </script>
</body>
</html>
